(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"08a3":function(t,e,n){"use strict";n.r(e);var i=n("68ea"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},"19e7":function(t,e,n){"use strict";n.r(e);var i=n("d1ca"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},"36fd":function(t,e,n){"use strict";var i;n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var o=function(){var t=this,e=t.$createElement;t._self._c},a=[]},"3b4b":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var i={uniPopup:function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-popup/uni-popup")]).then(n.bind(null,"3041"))}},o=function(){var t=this,e=t.$createElement;t._self._c},a=[]},"66fb":function(t,e,n){"use strict";n.r(e);var i=n("36fd"),o=n("19e7");for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("9b85");var l,u=n("f0c5"),s=Object(u["a"])(o["default"],i["b"],i["c"],!1,null,"0b8d4096",null,!1,i["a"],l);e["default"]=s.exports},"68ea":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n("66fb"));function o(t){return t&&t.__esModule?t:{default:t}}var a=n("66f0"),l=function(){Promise.all([n.e("common/vendor"),n.e("components/Description/Description")]).then(function(){return resolve(n("f493"))}.bind(null,n)).catch(n.oe)},u=function(){n.e("components/Search/Search").then(function(){return resolve(n("202f"))}.bind(null,n)).catch(n.oe)},s=function(){Promise.all([n.e("common/vendor"),n.e("components/uni-popup/uni-popup")]).then(function(){return resolve(n("3041"))}.bind(null,n)).catch(n.oe)},c=function(){n.e("components/Controls/Controls").then(function(){return resolve(n("21ff"))}.bind(null,n)).catch(n.oe)},d={components:{Description:l,Search:u,uniPopup:s,RoutePlan:i.default,Controls:c},data:function(){return{qqMap:null,mapCtx:null,mapKey:"YABBZ-YFMKF-DWBJJ-NN44U-RUZVJ-YIBRB",width:100,height:100,searchPage:!1,timer:null,chooseFlag:!1,startChange:!1,endChange:!1,region:"",mode:"driving",latitude:null,longitude:null,centerLatitude:null,centerLongitude:null,endLatitude:null,endLongitude:null,directionPolyLine:null,distance:null,duration:null,showCompass:!1,showLocation:!0,enable3D:!1,scale:16,enableTraffic:!1,enableSatellite:!1,markers:[],polyline:[],circles:[],circlesId:[],addressInfo:{}}},computed:{mapWidth:function(){return"".concat(this.width,"vw")},mapHeight:function(){return"".concat(this.height,"vh")}},onLoad:function(){var t=this;this.qqMap=new a({key:t.mapKey}),this.mapCtx=wx.createMapContext("map"),this.getLocation(),this.toggleFlag(),this.routePolyline(),this.circleMark(),this.searchLc(),this.updateLocation(),this.choosePosition(),this.positionChange(),this.toggleMode(),this.controls()},methods:{getLocation:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this;t.getLocation({type:"gcj02",success:function(t){n.latitude=t.latitude,n.longitude=t.longitude,getApp().globalData.startLatitude=t.latitude,getApp().globalData.startLongitude=t.longitude,e&&(n.centerLatitude=t.latitude,n.centerLongitude=t.longitude),n.reverseGeocoder(t.latitude,t.longitude,!0)},fail:function(t){console.log(t)}})},tapMap:function(e){if(this.chooseFlag){this.latitude=e.detail.latitude,this.longitude=e.detail.longitude,getApp().globalData.startLatitude=this.latitude,getApp().globalData.startLongitude=this.longitude;var n="/static/start.png";this.createMarkersItem(e,!1,n),this.reverseGeocoder(this.latitude,this.longitude,!1,!0),this.calculateDistance(this.mode,{latitude:this.latitude,longitude:this.longitude},{latitude:this.endLatitude,longitude:this.endLongitude}),this.direction(this.mode),this.chooseFlag=!1,t.$emit("changeFlag",!1)}else this.locationAssignment(e),this.createMarkersItem(e),this.reverseGeocoder(this.endLatitude,this.endLongitude),this.calculateDistance(this.mode,{latitude:this.latitude,longitude:this.longitude},{latitude:this.endLatitude,longitude:this.endLongitude})},tapCallout:function(t){console.log(t)},controltap:function(t){console.log(t)},createMarkersItem:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/static/markerIcon.png",i={latitude:t.detail.latitude,longitude:t.detail.longitude,id:t.timeStamp,iconPath:n,width:30,height:30};if(e){this.markers=[],this.markers.splice(0,0,i);var o={latitude:this.endLatitude,longitude:this.endLongitude,id:(new Date).getTime(),iconPath:"/static/end.png",width:30,height:30};this.markers.splice(1,0,o)}else{var a=this.markers.length;switch(a){case 0:this.markers.splice(0,0,i);break;case 1:this.markers.splice(0,1,i);break;case 2:this.chooseFlag?this.markers.splice(0,1,i):this.markers.splice(a,0,i);break;case 3:this.markers.splice(a-1,1,i);break}}},direction:function(e){var n=this;this.qqMap.direction({mode:e,from:{latitude:n.latitude,longitude:n.longitude},to:{latitude:n.endLatitude,longitude:n.endLongitude},success:function(e){t.$emit("routePolyline",e.result.routes[0])},fail:function(t){console.log(t)}})},reverseGeocoder:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this;this.qqMap.reverseGeocoder({location:{latitude:t,longitude:e},get_poi:1,success:function(t){o.addressInfo=t.result,i?getApp().globalData.outsetTitle=t.result.formatted_addresses.recommend:(getApp().globalData.destinationTitle=t.result.formatted_addresses.recommend,n&&(o.region=t.result.address_component.city))}})},calculateDistance:function(t,e,n){var i=this;this.qqMap.calculateDistance({mode:"driving",from:{latitude:e.latitude,longitude:e.longitude},to:[{location:{lat:n.latitude,lng:n.longitude}}],success:function(t){i.distance=t.result.elements[0].distance,i.duration=t.result.elements[0].duration},fail:function(t){console.log(t)}})},toggleFlag:function(){var e=this;t.$on("toggleSearch",(function(t){t.searchFlag?e.$refs.popupSearch.open():e.$refs.popupSearch.close()}))},searchLc:function(){var e=this;t.$on("searchLc",(function(n){if(e.startChange){e.latitude=n.lat,e.longitude=n.lng,getApp().globalData.startLatitude=e.latitude,getApp().globalData.startLongitude=e.longitude;var i="/static/start.png",o={detail:{latitude:n.lat,longitude:n.lng},timeStamp:(new Date).getTime()};e.createMarkersItem(o,!1,i),e.reverseGeocoder(e.latitude,e.longitude,!1,!0),e.calculateDistance(e.mode,{latitude:e.latitude,longitude:e.longitude},{latitude:e.endLatitude,longitude:e.endLongitude}),e.direction(e.mode),e.startChange=!1,e.chooseFlag=!1,t.$emit("reducePlaceholder",!0),e.myFlag&&(getApp().globalData.outsetTitle="我的位置",e.myFlag=!1),t.$emit("changeFlag",!1)}else{e.centerLatitude=n.lat,e.centerLongitude=n.lng,e.endLatitude=n.lat,e.endLongitude=n.lng,getApp().globalData.endLatitude=n.lat,getApp().globalData.endLongitude=n.lng;var a={detail:{latitude:n.lat,longitude:n.lng},timeStamp:(new Date).getTime()};e.createMarkersItem(a),e.direction(e.mode),e.reverseGeocoder(e.endLatitude,e.endLongitude),e.calculateDistance(e.mode,{latitude:e.latitude,longitude:e.longitude},{latitude:e.endLatitude,longitude:e.endLongitude})}}))},routePolyline:function(){var e=this;t.$on("routePolyline",(function(t){e.includePoints();var n=[];if(t.mode){var i={};i.mode=t.mode,i.polyline=e.unzip(t.polyline),n.push(i)}else t.steps.forEach((function(t){if("WALKING"===t.mode){var i={};i.mode=t.mode,i.polyline=e.unzip(t.polyline),n.push(i)}if("TRANSIT"===t.mode){var o={};o.mode=t.mode,o.polyline=e.unzip(t.lines[0].polyline),n.push(o)}}));var o=[];n.forEach((function(t){for(var e={},n=[],i=0;i<t.polyline.length;i+=2)n.push({latitude:t.polyline[i],longitude:t.polyline[i+1]});e.points=n,e.width=4,"WALKING"===t.mode&&(e.color="#11659a"),"TRANSIT"===t.mode&&(e.color="#9b1e64"),"DRIVING"===t.mode&&(e.color="#fecc11"),"BICYCLING"===t.mode&&(e.color="#fffef9"),o.push(e)})),e.polyline=o;var a={detail:{latitude:e.latitude,longitude:e.longitude},timeStamp:(new Date).getTime()},l="/static/start.png";e.createMarkersItem(a,!0,l),e.circles=[]}))},unzip:function(t){for(var e=2;e<t.length;e++)t[e]=t[e-2]+t[e]/1e6;return t},circleMark:function(){var e=this;t.$on("circleMark",(function(t){console.log(t),e.markers=[]}))},locationAssignment:function(t){this.endLatitude=t.detail.latitude,this.endLongitude=t.detail.longitude,getApp().globalData.endLatitude=t.detail.latitude,getApp().globalData.endLongitude=t.detail.longitude,this.centerLatitude=t.detail.latitude,this.centerLongitude=t.detail.longitude},updateLocation:function(){var e=this;t.$on("updateLocation",(function(n){e.latitude=n.latitude,e.longitude=n.longitude,e.reverseGeocoder(e.latitude,e.longitude,!1,!0),t.$emit("searchLc",{lat:getApp().globalData.startLatitude,lng:getApp().globalData.startLongitude}),t.navigateTo({url:"../RoutePlan/RoutePlan"})}))},choosePosition:function(){var e=this;t.$on("choosePosition",(function(t){e.chooseFlag=!0,console.log(t)}))},positionChange:function(){var e=this;t.$on("positionChange",(function(t){"start"===t&&(e.startChange=!0)}))},toggleMode:function(){var e=this;t.$on("toggleMode",(function(t){e.mode=t.mode}))},getScale:function(){var t=this;this.mapCtx.getScale({success:function(e){t.scale=e.scale}})},regionchange:function(t){var e=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){"end"===t.type&&e.getScale()}),2e3)},includePoints:function(){this.mapCtx.includePoints({padding:[70],points:[{latitude:getApp().globalData.startLatitude,longitude:getApp().globalData.startLongitude},{latitude:getApp().globalData.endLatitude,longitude:getApp().globalData.endLongitude}]})},controls:function(){var e=this;t.$on("controls",(function(t){switch(t){case"increase":18===e.scale?e.scale=18:e.scale++;break;case"decrease":5===e.scale?e.scale=5:e.scale--;break;case"satellite":e.enableSatellite=!e.enableSatellite;break;case"traffic":e.enableTraffic=!e.enableTraffic;break;case"compass":e.showCompass=!e.showCompass;break}}))}}};e.default=d}).call(this,n("543d")["default"])},"77d4":function(t,e,n){"use strict";(function(t){n("2c15");i(n("66fd"));var e=i(n("e8f1"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"83a7":function(t,e,n){},"9b85":function(t,e,n){"use strict";var i=n("83a7"),o=n.n(i);o.a},d1ca:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){n.e("pages/RoutePlan/RouteNav").then(function(){return resolve(n("ff5b"))}.bind(null,n)).catch(n.oe)},o=function(){Promise.all([n.e("common/vendor"),n.e("pages/RoutePlan/RouteDetail")]).then(function(){return resolve(n("dfe2"))}.bind(null,n)).catch(n.oe)},a=function(){n.e("pages/RoutePlan/RoutePosition").then(function(){return resolve(n("54b2"))}.bind(null,n)).catch(n.oe)},l={name:"RoutePlan",components:{RouteNav:i,RouteDetail:o,RoutePosition:a}};e.default=l},e8f1:function(t,e,n){"use strict";n.r(e);var i=n("3b4b"),o=n("08a3");for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);var l,u=n("f0c5"),s=Object(u["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],l);e["default"]=s.exports}},[["77d4","common/runtime","common/vendor"]]]);